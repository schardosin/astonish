"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[6883],{6044:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>a,contentTitle:()=>o,default:()=>h,frontMatter:()=>l,metadata:()=>t,toc:()=>d});const t=JSON.parse('{"id":"api/core/agent-runner","title":"Agent Runner","description":"The Agent Runner is responsible for executing agentic flows in Astonish. It loads agent configurations, initializes tools, builds the execution graph, and runs the flow.","source":"@site/docs/api/core/agent-runner.md","sourceDirName":"api/core","slug":"/api/core/agent-runner","permalink":"/astonish/docs/api/core/agent-runner","draft":false,"unlisted":false,"editUrl":"https://github.com/schardosin/astonish/tree/main/docs/docs/api/core/agent-runner.md","tags":[],"version":"current","sidebarPosition":1,"frontMatter":{"sidebar_position":1},"sidebar":"tutorialSidebar","previous":{"title":"Advanced Flows","permalink":"/astonish/docs/tutorials/advanced-flows"},"next":{"title":"Internal Tools","permalink":"/astonish/docs/api/tools/internal-tools"}}');var r=i(4848),s=i(8453);const l={sidebar_position:1},o="Agent Runner",a={},d=[{value:"Overview",id:"overview",level:2},{value:"Functions",id:"functions",level:2},{value:"run_agent",id:"run_agent",level:3},{value:"Parameters",id:"parameters",level:4},{value:"Returns",id:"returns",level:4},{value:"Example",id:"example",level:4},{value:"Process",id:"process",level:4},{value:"Error Handling",id:"error-handling",level:2},{value:"Dependencies",id:"dependencies",level:2},{value:"Implementation Details",id:"implementation-details",level:2},{value:"State Initialization",id:"state-initialization",level:3},{value:"Error Tracking",id:"error-tracking",level:3},{value:"Graph Execution",id:"graph-execution",level:3},{value:"Related Modules",id:"related-modules",level:2}];function c(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,s.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"agent-runner",children:"Agent Runner"})}),"\n",(0,r.jsx)(n.p,{children:"The Agent Runner is responsible for executing agentic flows in Astonish. It loads agent configurations, initializes tools, builds the execution graph, and runs the flow."}),"\n",(0,r.jsx)(n.h2,{id:"overview",children:"Overview"}),"\n",(0,r.jsxs)(n.p,{children:["The ",(0,r.jsx)(n.code,{children:"agent_runner.py"})," module contains the core functionality for running agents. It provides the ",(0,r.jsx)(n.code,{children:"run_agent"})," function, which is the main entry point for executing agentic flows."]}),"\n",(0,r.jsx)(n.h2,{id:"functions",children:"Functions"}),"\n",(0,r.jsx)(n.h3,{id:"run_agent",children:"run_agent"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:"async def run_agent(agent: str) -> None\n"})}),"\n",(0,r.jsx)(n.p,{children:"Runs an agentic flow with the specified name."}),"\n",(0,r.jsx)(n.h4,{id:"parameters",children:"Parameters"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"agent"})," (str): The name of the agent to run. This should correspond to a YAML file in one of the agent directories."]}),"\n"]}),"\n",(0,r.jsx)(n.h4,{id:"returns",children:"Returns"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"None"})}),"\n"]}),"\n",(0,r.jsx)(n.h4,{id:"example",children:"Example"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:'await run_agent("file_summarizer")\n'})}),"\n",(0,r.jsx)(n.h4,{id:"process",children:"Process"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsx)(n.li,{children:"Sets up colorama for colored terminal output"}),"\n",(0,r.jsx)(n.li,{children:"Loads the agent configuration from the YAML file"}),"\n",(0,r.jsx)(n.li,{children:"Initializes MCP tools if available"}),"\n",(0,r.jsx)(n.li,{children:"Initializes the state with variables from the output models"}),"\n",(0,r.jsx)(n.li,{children:"Builds the execution graph using the agent configuration"}),"\n",(0,r.jsx)(n.li,{children:"Runs the graph with the initial state"}),"\n",(0,r.jsx)(n.li,{children:"Handles any errors that occur during execution"}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"error-handling",children:"Error Handling"}),"\n",(0,r.jsx)(n.p,{children:"The Agent Runner includes robust error handling to ensure that errors during agent execution are properly reported to the user. It handles:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Missing agent files"}),"\n",(0,r.jsx)(n.li,{children:"Errors loading agent configurations"}),"\n",(0,r.jsx)(n.li,{children:"Errors initializing MCP tools"}),"\n",(0,r.jsx)(n.li,{children:"Errors building the execution graph"}),"\n",(0,r.jsx)(n.li,{children:"Errors during graph execution"}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"dependencies",children:"Dependencies"}),"\n",(0,r.jsx)(n.p,{children:"The Agent Runner depends on several other modules:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"astonish.globals"}),": Global variables and configuration"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"langchain.globals"}),": LangChain configuration"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"langgraph.checkpoint.sqlite.aio.AsyncSqliteSaver"}),": Checkpoint saving for graph execution"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"astonish.core.utils"}),": Utility functions for setup, loading agents, and printing"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"astonish.core.graph_builder"}),": Functions for building and running the execution graph"]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"implementation-details",children:"Implementation Details"}),"\n",(0,r.jsx)(n.h3,{id:"state-initialization",children:"State Initialization"}),"\n",(0,r.jsx)(n.p,{children:"The Agent Runner initializes the state dictionary with variables from the output models of all nodes in the agent configuration. This ensures that all variables used in the flow are properly initialized."}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:"# Initialize state\ninitial_state = {}\nfor node in config['nodes']:\n    if 'output_model' in node:\n        for field, type_ in node['output_model'].items():\n            if field not in initial_state:\n                initial_state[field] = None\n    \n    # Add initialization for limit_counter_field\n    if 'limit_counter_field' in node:\n        limit_counter_field = node['limit_counter_field']\n        if limit_counter_field not in initial_state:\n            initial_state[limit_counter_field] = 0  # Initialize to 0\n"})}),"\n",(0,r.jsx)(n.h3,{id:"error-tracking",children:"Error Tracking"}),"\n",(0,r.jsx)(n.p,{children:"The Agent Runner adds special fields to the state for tracking errors:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:"# Add error tracking fields\ninitial_state['_error'] = None\ninitial_state['_end'] = False\n"})}),"\n",(0,r.jsx)(n.p,{children:"These fields are used by the error handling system to track and report errors during execution."}),"\n",(0,r.jsx)(n.h3,{id:"graph-execution",children:"Graph Execution"}),"\n",(0,r.jsxs)(n.p,{children:["The Agent Runner uses the ",(0,r.jsx)(n.code,{children:"AsyncSqliteSaver"})," to save checkpoints during graph execution. This allows for potential future features like resuming interrupted flows."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:'async with AsyncSqliteSaver.from_conn_string(":memory:") as checkpointer:\n    thread = {"configurable": {"thread_id": "1"}, "recursion_limit": 200}\n    \n    # Build and run the graph\n    graph = build_graph(config, mcp_client, checkpointer)\n    final_state = await run_graph(graph, initial_state, thread)\n'})}),"\n",(0,r.jsx)(n.h2,{id:"related-modules",children:"Related Modules"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Graph Builder"}),": Builds and runs the execution graph"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Node Functions"}),": Defines the functions for different node types"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Utils"}),": Utility functions for agent execution"]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(c,{...e})}):c(e)}},8453:(e,n,i)=>{i.d(n,{R:()=>l,x:()=>o});var t=i(6540);const r={},s=t.createContext(r);function l(e){const n=t.useContext(s);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:l(e.components),t.createElement(s.Provider,{value:n},e.children)}}}]);